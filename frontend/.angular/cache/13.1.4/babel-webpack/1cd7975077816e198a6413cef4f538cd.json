{"ast":null,"code":"var _asyncToGenerator = require(\"C:\\\\Users\\\\59162\\\\Documents\\\\proyecto_angular\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\asyncToGenerator.js\").default;\n\nvar _this = this;\n\nconst createJob = require('./createJob');\n\nconst {\n  log\n} = require('./utils/log');\n\nconst getId = require('./utils/getId');\n\nlet schedulerCounter = 0;\n\nmodule.exports = () => {\n  const id = getId('Scheduler', schedulerCounter);\n  const workers = {};\n  const runningWorkers = {};\n  let jobQueue = [];\n  schedulerCounter += 1;\n\n  const getQueueLen = () => jobQueue.length;\n\n  const getNumWorkers = () => Object.keys(workers).length;\n\n  const dequeue = () => {\n    if (jobQueue.length !== 0) {\n      const wIds = Object.keys(workers);\n\n      for (let i = 0; i < wIds.length; i += 1) {\n        if (typeof runningWorkers[wIds[i]] === 'undefined') {\n          jobQueue[0](workers[wIds[i]]);\n          break;\n        }\n      }\n    }\n  };\n\n  const queue = (action, payload) => new Promise((resolve, reject) => {\n    const job = createJob({\n      action,\n      payload\n    });\n    jobQueue.push( /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* (w) {\n        jobQueue.shift();\n        runningWorkers[w.id] = job;\n\n        try {\n          resolve(yield w[action].apply(_this, [...payload, job.id]));\n        } catch (err) {\n          reject(err);\n        } finally {\n          delete runningWorkers[w.id];\n          dequeue();\n        }\n      });\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n    log(`[${id}]: Add ${job.id} to JobQueue`);\n    log(`[${id}]: JobQueue length=${jobQueue.length}`);\n    dequeue();\n  });\n\n  const addWorker = w => {\n    workers[w.id] = w;\n    log(`[${id}]: Add ${w.id}`);\n    log(`[${id}]: Number of workers=${getNumWorkers()}`);\n    dequeue();\n    return w.id;\n  };\n\n  const addJob = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator(function* (action, ...payload) {\n      if (getNumWorkers() === 0) {\n        throw Error(`[${id}]: You need to have at least one worker before adding jobs`);\n      }\n\n      return queue(action, payload);\n    });\n\n    return function addJob(_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  const terminate = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator(function* () {\n      Object.keys(workers).forEach( /*#__PURE__*/function () {\n        var _ref4 = _asyncToGenerator(function* (wid) {\n          yield workers[wid].terminate();\n        });\n\n        return function (_x3) {\n          return _ref4.apply(this, arguments);\n        };\n      }());\n      jobQueue = [];\n    });\n\n    return function terminate() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  return {\n    addWorker,\n    addJob,\n    terminate,\n    getQueueLen,\n    getNumWorkers\n  };\n};","map":{"version":3,"sources":["C:/Users/59162/Documents/proyecto_angular/frontend/node_modules/tesseract.js/src/createScheduler.js"],"names":["createJob","require","log","getId","schedulerCounter","module","exports","id","workers","runningWorkers","jobQueue","getQueueLen","length","getNumWorkers","Object","keys","dequeue","wIds","i","queue","action","payload","Promise","resolve","reject","job","push","w","shift","apply","err","addWorker","addJob","Error","terminate","forEach","wid"],"mappings":"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","sourcesContent":["const createJob = require('./createJob');\nconst { log } = require('./utils/log');\nconst getId = require('./utils/getId');\n\nlet schedulerCounter = 0;\n\nmodule.exports = () => {\n  const id = getId('Scheduler', schedulerCounter);\n  const workers = {};\n  const runningWorkers = {};\n  let jobQueue = [];\n\n  schedulerCounter += 1;\n\n  const getQueueLen = () => jobQueue.length;\n  const getNumWorkers = () => Object.keys(workers).length;\n\n  const dequeue = () => {\n    if (jobQueue.length !== 0) {\n      const wIds = Object.keys(workers);\n      for (let i = 0; i < wIds.length; i += 1) {\n        if (typeof runningWorkers[wIds[i]] === 'undefined') {\n          jobQueue[0](workers[wIds[i]]);\n          break;\n        }\n      }\n    }\n  };\n\n  const queue = (action, payload) => (\n    new Promise((resolve, reject) => {\n      const job = createJob({ action, payload });\n      jobQueue.push(async (w) => {\n        jobQueue.shift();\n        runningWorkers[w.id] = job;\n        try {\n          resolve(await w[action].apply(this, [...payload, job.id]));\n        } catch (err) {\n          reject(err);\n        } finally {\n          delete runningWorkers[w.id];\n          dequeue();\n        }\n      });\n      log(`[${id}]: Add ${job.id} to JobQueue`);\n      log(`[${id}]: JobQueue length=${jobQueue.length}`);\n      dequeue();\n    })\n  );\n\n  const addWorker = (w) => {\n    workers[w.id] = w;\n    log(`[${id}]: Add ${w.id}`);\n    log(`[${id}]: Number of workers=${getNumWorkers()}`);\n    dequeue();\n    return w.id;\n  };\n\n  const addJob = async (action, ...payload) => {\n    if (getNumWorkers() === 0) {\n      throw Error(`[${id}]: You need to have at least one worker before adding jobs`);\n    }\n    return queue(action, payload);\n  };\n\n  const terminate = async () => {\n    Object.keys(workers).forEach(async (wid) => {\n      await workers[wid].terminate();\n    });\n    jobQueue = [];\n  };\n\n  return {\n    addWorker,\n    addJob,\n    terminate,\n    getQueueLen,\n    getNumWorkers,\n  };\n};\n"]},"metadata":{},"sourceType":"script"}